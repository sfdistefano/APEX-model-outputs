      SUBROUTINE SOLT_TT
!     EPIC1905
!     THIS SUBPROGRAM ESTIMATES DAILY AVEAGE TEMPERATURE AT THE CENTER
!     OF EACH SOIL LAYER USING PSEUDO HEAT TRANSFER FUNCTIONS.
      USE PARM
      DATA XAVT/.5/
      ST0X=ST0(ISA)
      LD1=LID(1,ISA)
      ! CALCULATE DAMPING DEPTH AS A FUNCTION OF AVERAGE BULK DENSITY AND WATER CONTENT. 
      F=ABD(ISA)/(ABD(ISA)+686.*EXP(-5.63*ABD(ISA)))
      DP=1.+2.5*F
      WW=.356-.144*ABD(ISA)
      B=LOG(.5/DP)
      WC=.001*SW(ISA)/(WW*Z(LID(NBSL(ISA),ISA),ISA))
      F=EXP(B*((1.-WC)/(1.+WC))**2)
      DD=F*DP
      ! CALCULATE SOIL SURFACE TEMPERATURE TODAY USING COSINE FUNCTION
      X4=.5*AMPX
      X8=(IDA-200)/PIT
      DST0(ISA)=AVT+X4*COS(X8)
      ! CALCULATE TEMP / RADIATION FACTOR
      X1=(TMX(IRF(ISA))-TMN(IRF(ISA)))*SQRT(.03*ST0X)
      ! DECIDE BETWEEN COOL AND WARM SEASON
      X2=DST0(ISA)
      IF(X2<AVT)THEN
          ! COOL SEASON
          BCV(ISA)=SNOF
          ! CALCULATE SURFACE TEMP DSTC USING TX & TMN
          DSTC=.5*(TX+TMN(IRF(ISA)))
          ! ADJUST DSTC USING NORMAL TEMP FOR TODAY 
          IF(TX<0.)THEN
              DSTC=.5*(DSTC+X2)
          ELSE
              DSTC=MIN(DSTC,X2)
          END IF
          ! ADJUST FOR SOLAR RADIATION
          IF(SRAD(IRF(ISA))>10.)THEN
              F=ST0X/(ST0X+EXP(SCRP(19,1)-SCRP(19,2)*ST0X))
              DSTC=DSTC+X1*F
          END IF    
      ELSE
          ! WARM SEASON
          DSTC=TX+(1.-BCV(ISA))*X1
          DSTC=MAX(DSTC,X2)
      END IF    
      ! CALCULATE IDEAL BULK DENSITY (BNW)
      OC=.1*WOC(LD1,ISA)/WT(LD1,ISA)                                                                  
      OM=1.72*OC
      AD1=SAN(LD1,ISA)+SIL(LD1,ISA)+CLA(LD1,ISA)+OM
      BDO=(1.6*SAN(LD1,ISA)+1.3*SIL(LD1,ISA)+1.1*CLA(LD1,ISA)+.224*OM)/AD1
      ! CALCULATE BULK DENSITY FACTOR
      BDF=BDO/1.25
      ! CALCULATE SOIL WATER FACTOR
      XX=SWST(LD1,ISA)-S15(LD1,ISA)
      IF(XX>0.)THEN
          WF=1.2*EXP(-.4055*XX/(FC(LD1,ISA)-S15(LD1,ISA)))
      ELSE
          WF=1.2
      END IF
      ! CALCULATE SURFACE TRANSFER COEFFICIENT 
      TCF=.6*BDF*WF*(1.-SNOF)
      ! CALCULATE TEMP TRANSFER
      DT12=TCF*(DSTC-STMP(LD1,ISA))
      ! ADJUST TEMP IN LAYER 1 USING TEMP TRANSFER  
      STMP(LD1,ISA)=STMP(LD1,ISA)+DT12
      ! REPEAT CALCULATIONS FOR EACH LAYER
      DO J=2,NBSL(ISA)
          L1=LID(J-1,ISA)
          L2=LID(J,ISA)
          !TCF1=TCF
          OC=.1*WOC(L2,ISA)/WT(L2,ISA)                                                                  
          OM=1.72*OC
          AD1=SAN(L2,ISA)+SIL(L2,ISA)+CLA(L2,ISA)+OM
          BDO=(1.6*SAN(L2,ISA)+1.3*SIL(L2,ISA)+1.1*CLA(L2,ISA)+.224*OM)/AD1
          BDF=BDO/1.25
          XX=SWST(L2,ISA)-S15(L2,ISA)
          IF(XX>0.)THEN
              WF=1.2*EXP(-.4055*XX/(FC(L2,ISA)-S15(L2,ISA)))
          ELSE
              WF=1.2
          END IF 
          TCF=.6*BDF*WF  
          !DT12=.5*(TCF+TCF1)*(STMP(L1,ISA)-STMP(L2,ISA))
          DT12=TCF*(STMP(L1,ISA)-STMP(L2,ISA))
          STMP(L1,ISA)=STMP(L1,ISA)-DT12*.9  
          STMP(L2,ISA)=STMP(L2,ISA)+DT12
      END DO
      ! CALCULATE FRACTION OF DAMPING DEPTH FOR BOTTOM OF SOIL PROFILE
      X7=Z(L2,ISA)/DD
      ! ESTIMATE COSINE FUNCTION TEMP AT BOTTOM OF SOIL PROFILE
      X5=EXP(-2.*X7)
      STBL=AVT+X4*COS(X8-X7)*X5
      ! ADJUST SOIL TEMP IN BOTTOM LAYER BASED ON STABLE TEMP
      STMP(L2,ISA)=XAVT*STBL+(1.-XAVT)*STMP(L2,ISA)
      IF(KFL(10)>0)WRITE(KW(10),107)IYR,MO,KDA,TMX(IRF(ISA)),TMN(IRF(ISA)),SRAD(IRF(ISA)),X2,&
      DSTC,(STMP(LID(K,ISA),ISA),K=1,NBSL(ISA)),STBL,SNO(ISA),CV(ISA),BCV(ISA),DD,RZSW(ISA) 
      DO J=1,NBSL(ISA)
          ISL=LID(J,ISA)
          IF(STMP(ISL,ISA)<0..AND.Z(ISL,ISA)>FRSTMX(IY,ISA))FRSTMX(IY,ISA)=Z(ISL,ISA)
      END DO    
      RETURN
  107 FORMAT(1X,3I4,50F10.3)                                      
      END