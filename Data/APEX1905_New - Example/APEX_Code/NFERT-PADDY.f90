      SUBROUTINE NFERT_PADDY(JFT,KTX,JRT)
!     APEX1905
!     THIS SUBPROGRAM APPLIES N AND P FERTILIZER TO A PADDY FIELD AT SPECIFIED DATES,
!     RATES, AND DEPTH OR AUTOMATICALLY.  Modified from NFERT.F90 by Jaehak Jeong for paddy modeling
      USE PARM
      JRT=0
!     IF(ANA(IRO(ISA),ISA)>=FNMX(IRO(ISA),ISA).AND.IRC/=1)RETURN
      X1=0.
      I=LID(1,ISA)
      ZFT=TLD(JFT)
      WSAX=WSA(ISA) 
      KF=LFT(IRO(ISA),KTX,ISA)
      X1=WFA(IRO(ISA),KTX,ISA)

      IF(MNUL/=0)THEN
          XX=FP(KF)+FPO(KF)
          XX1=XMAP(ISA)/XX
          XX2=SAMA(ISA)/XX
          IF(XX2>=XX1)THEN
              JRT=1
              RETURN 
          END IF
          APMU(ISA)=MIN(APMU(ISA),XX1-XX2)
      END IF
      
      X3=X1*FN(KF)
      X2=X1*FP(KF)
      X4=X3*FNMA(KF)
      X5=X1*FNO(KF)
      X6=X1*FPO(KF)
      X7=X3-X4
      X8=X1*FOC(KF)
      X11=X1*FSLT(KF)
      SMM(99,MO,ISA)=SMM(99,MO,ISA)+X8
      VAR(99,ISA)=X8
      
      !Add nutrients in fertilizer to ponding water
      PADDY_STO(3,ISA)=PADDY_STO(3,ISA)+X3 !Mineral N(NH3+NO3), kg/ha
      PADDY_STO(4,ISA)=PADDY_STO(4,ISA)+X2 !Mineral P, kg/ha
      PADDY_STO(5,ISA)=PADDY_STO(5,ISA)+X5 !Organic N, kg/ha
      PADDY_STO(6,ISA)=PADDY_STO(6,ISA)+X6 !Organic P, kg/ha
         
      Z1=.001*X1
      SMM(78,MO,ISA)=SMM(78,MO,ISA)+Z1
      SMM(53,MO,ISA)=SMM(53,MO,ISA)+X5*WSAX
      SMM(56,MO,ISA)=SMM(56,MO,ISA)+X6*WSAX
      SMM(54,MO,ISA)=SMM(54,MO,ISA)+X7*WSAX
      SMM(55,MO,ISA)=SMM(55,MO,ISA)+X4*WSAX
      SMM(57,MO,ISA)=SMM(57,MO,ISA)+X2*WSAX
      ANA(IRO(ISA),ISA)=ANA(IRO(ISA),ISA)+X3

      TFNO=TFNO+X5*WSA(ISA)
      TFMN=TFMN+X7*WSA(ISA)
      TFMA=TFMA+X4*WSA(ISA)
      VAR(53,ISA)=X5
      VAR(56,ISA)=X6
      VAR(54,ISA)=X7
      VAR(55,ISA)=X4
      VAR(57,ISA)=X2
      SMM(132,MO,ISA)=SMM(132,MO,ISA)+X11
      FRTN(JJK,ISA)=FRTN(JJK,ISA)+X3+X5
      FRTP(JJK,ISA)=FRTP(JJK,ISA)+X2+X6
      VAR(132,ISA)=X11
	   XX=X1*FCST(KF)
      COST(ISA)=COST(ISA)+XX
      IF(KFL(31)>0)THEN
          WRITE(KW(31),34)ISA,NBSA(ISA),IYR,MO,KDA,FTNM(KF),KDC(JJK),&
          KDF(KF),IHC(JFT),NBE(JFT),NBT(JFT),XX,XX,X1
      END IF
      IF(NOP>0.OR.NBSA(ISA)==ISAP.AND.X3>0.)THEN
          WRITE(KW(1),11)ISA,NBSA(ISA),IYR,MO,KDA,IDON(ISA),IHD,FTNM(KF)&
          ,X1,ZFT,X3,X4,X5,X2,X6,XHSM(ISA)
      END IF
      IF(KFL(19)>0)WRITE(KW(19),22)ISA,NBSA(ISA),IYR,MO,KDA,IY,IDON&
      (ISA),IHD,FTNM(KF),X1,X3,X4,X5,X2,X6
      APMU(ISA)=X1*WSA(ISA)
      FCMN(ISA)=FCMN(ISA)+X3+X5
      FCMP(ISA)=FCMP(ISA)+X2+X6
      NDFA(ISA)=0
      
      RETURN
   11 FORMAT(1X,2I8,1X,I4,2I2,2X,'IDON=',I4,2X,'HRD#=',I3,2X,A8,2X,&
      'RATE=',F8.0,'kg/ha',1X,'DPTH=',F8.2,'mm ELEM WT(kg/ha)--',1X,'MN='&
      ,F7.0,1X,'NH3=',F7.0,1X,'ON=',F7.0,1X,'MP=',F7.0,1X,'OP=',F7.0,1X,&
      'HUSC=',F5.2)
   22 FORMAT(1X,2I8,1X,I4,2I2,3I4,3X,A8,F8.0,6F8.2)
   25 FORMAT(1X,2I8,1X,I4,2I2,2X,'IDON=',I4,2X,'FA#=',I4,2X,A8,2X,&
      'RATE=',F8.0,'kg/ha',1X,'DPTH=',F8.2,'mm ELEM WT(kg/ha)--',1X,'MN='&
      ,F7.0,1X,'NH3=',F7.0,1X,'ON=',F7.0,1X,'MP=',F7.0,1X,'OP=',F7.0,1X,&
      'HUSC=',F5.2)
   34 FORMAT(1X,2I8,1X,I4,2I2,2X,A8,8X,I6,2X,4I4,F10.2,10X,2F10.2)
   50 FORMAT(1X,2I8,1X,I4,2I2,2X,A8,8X,I6,6X,3I4,2F10.2,20X,F10.2)
      END